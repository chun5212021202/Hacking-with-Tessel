var util = require('util');
var EventEmitter = require('events').EventEmitter;

function Pulsesensor(hardware) {
  var self = this;
  self.hardware = hardware;//analogpin

  setImmediate(function emitReady() {
    self.emit('ready');
  });

}

util.inherits(Pulsesensor, EventEmitter);

Pulsesensor.prototype.start = function(upperboarder, lowerboarder, samplerate){

  var self = this;
  self.intervalhandler = setInterval(function () {
		var rlt = self.hardware.read();
  	console.log(rlt);
		if(rlt > upperboarder){
			if (state != 2){
				self.emit('rise');
			}
		}
		else if(rlt > lowerboarder){
			if (state != 0){
				self.emit('static');
			}
		}
		else{
			if (state != 1){
				self.emit('fall');
			}
		}
  }, samplerate);
};

Pulsesensor.prototype.stop= function(){
  var self = this;
	clearInterval(self.intervalhandler);
};

function use(hardware) {
  return new Pulsesensor(hardware);
}

exports.Pulsesensor = Pulsesensor;
exports.use = use;
